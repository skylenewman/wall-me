Pakyow::App.routes do

  default do
    # render the profile list
    view.partial(:list).scope(:profile).mutate(:list,
      with: data(:profile).all).subscribe

    # setup the form for a new object
    view.partial(:manual_checkin).scope(:profile).bind({})
  end

  restful :profile, '/profiles' do

    action :create do
      # create the profile
      data(:profile).create(params[:profile])
      
      # go back
      redirect :default
    end

  end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         

  get '/export' do
    # Feature to locally export and save a roster.
    # Grab all Profile entries, build CSV, export to local machine via browser
    profiles = Profile.all
    csv_string = CSV.generate do |csv|
     csv << ["Id", "Name", "Email", "Objective"]
     profiles.each do |profile|
       csv << [profile.id, profile.name, profile.email, profile.objective]
     end
   end

   send csv_string, 'text/csv', 'profiles.csv'

 end

end #/routes
